<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Sign In</title>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <meta name="google-signin-client_id"
        content="244810539298-nmbmqnihf67tpf0m4erk5m77cuk3bug7.apps.googleusercontent.com">
</head>
<div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
<br />
<input type="button" onclick="signOut();" value="Sign out" />
</body>
<script>
    // Get Coolie for CSRF Token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    function onSignIn(googleUser) {
        console.log("Sign in successful! Yay!");
        let id_token = googleUser.getAuthResponse().id_token;
        let xhr = new XMLHttpRequest();
        xhr.open('POST', 'http://localhost:8000/api/v1/accounts/login/google/');
        xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onload = function () {
            console.log('Signed in as: ' + xhr.responseText);
        };
        let send_params = 'provider=google-oauth2&code=' + id_token;
        console.log("Sending: " + send_params);
        xhr.send(send_params);
    }
    function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
            console.log('User signed out.');
        });
    }
</script>

</html>